/**
 * Opportunity Drizzle Schema
 * Generated by entity codegen - do not edit directly
 */

import { relations } from 'drizzle-orm';
import {
	date,
	doublePrecision,
	pgTable,
	timestamp,
	uuid,
	varchar,
	index,
} from 'drizzle-orm/pg-core';
import { organizations } from './organizations.schema';
import { users } from './users.schema';
import { deal_states } from './deal_states.schema';

export const opportunities = pgTable('opportunities', {
	id: uuid('id').defaultRandom().primaryKey(),
	tenantId: uuid('tenant_id').notNull(),
	name: varchar('name', { length: 255 }).notNull(),
	organizationId: uuid('organization_id').notNull().references(() => organizations.id),
	ownerId: uuid('owner_id').notNull().references(() => users.id),
	stateId: uuid('state_id').notNull().references(() => deal_states.id),
	amount: doublePrecision('amount'),
	currency: varchar('currency', { length: 3 }),
	expectedCloseDate: date('expected_close_date', { mode: 'date' }),
	closedAt: timestamp('closed_at'),
}, (table) => ({
	organizationIdIdx: index('idx_opportunities_organization_id').on(table.organizationId),
	ownerIdIdx: index('idx_opportunities_owner_id').on(table.ownerId),
	stateIdIdx: index('idx_opportunities_state_id').on(table.stateId),
	tenantIdIdx: index('idx_opportunities_tenant_id').on(table.tenantId),
	organizationIdIdx: index('idx_opportunities_organization_id').on(table.organizationId),
	ownerIdIdx: index('idx_opportunities_owner_id').on(table.ownerId),
	stateIdIdx: index('idx_opportunities_state_id').on(table.stateId),
}));

export const opportunitiesRelations = relations(opportunities, ({ one }) => ({
	organization: one(organizations, {
		fields: [opportunities.organizationId],
		references: [organizations.id],
	}),
	owner: one(users, {
		fields: [opportunities.ownerId],
		references: [users.id],
	}),
	state: one(deal_states, {
		fields: [opportunities.stateId],
		references: [deal_states.id],
	}),
}));

export type OpportunityRecord = typeof opportunities.$inferSelect;
export type NewOpportunityRecord = typeof opportunities.$inferInsert;
