/**
 * Create Opportunity Command
 * Generated by entity codegen - do not edit directly
 *
 * EXTENSION POINTS (add business logic here):
 * - Validation: Add domain validation rules before creating
 * - Defaults: Compute default values not handled by DTO
 * - Side effects: Emit events, send notifications, create related entities
 * - Authorization: Check user permissions beyond route-level auth
 * - Audit: Log creation for compliance/debugging
 */

import { Inject, Injectable } from '@nestjs/common';
import { OPPORTUNITY_REPOSITORY } from '../../../constants';
import type { CreateOpportunityInput, IOpportunityRepository } from '../../../domain';
import { Opportunity } from '../../../domain';
import type { CreateOpportunityDto } from '../../schemas';

@Injectable()
export class CreateOpportunityCommand {
	constructor(
		@Inject(OPPORTUNITY_REPOSITORY)
		private readonly opportunityRepository: IOpportunityRepository,
	) {}

	async execute(dto: CreateOpportunityDto): Promise<Opportunity> {
		// TODO: Add pre-create validation and business rules here

		// Map DTO to domain input
		const input: CreateOpportunityInput = {
			tenantId: dto.tenantId,
			name: dto.name,
			organizationId: dto.organizationId,
			ownerId: dto.ownerId,
			stateId: dto.stateId,
			amount: dto.amount ?? null,
			currency: dto.currency ?? null,
			expectedCloseDate: dto.expectedCloseDate ?? null,
			closedAt: dto.closedAt ?? null,
		};

		const created = await this.opportunityRepository.create(input);

		// TODO: Add post-create side effects here (events, notifications, etc.)

		return created;
	}
}
