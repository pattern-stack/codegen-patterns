/**
 * Organization tRPC Module
 * Generated by entity codegen - do not edit directly
 *
 * Provides tRPC procedures for Organization CRUD operations.
 * Mounts on /api/trpc/organizations
 */

import { Module } from '@nestjs/common';
import { TrpcModule } from './trpc/trpc.module';
import { Router, publicProcedure } from './trpc/trpc.router';
import { z } from 'zod';
import {
	organizationSchema,
	createOrganizationSchema,
	updateOrganizationSchema,
} from '@repo/db/entities/organization';
import { GetOrganizationByIdQuery } from '../application/queries/organization/get-by-id.query';
import { ListOrganizationsQuery } from '../application/queries/organization/list.query';
import { CreateOrganizationCommand } from '../application/commands/organization/create.command';
import { UpdateOrganizationCommand } from '../application/commands/organization/update.command';
import { DeleteOrganizationCommand } from '../application/commands/organization/delete.command';
import { OrganizationsModule } from './organizations.module';

@Module({
	imports: [TrpcModule, OrganizationsModule],
})
export class OrganizationTrpcModule {
	constructor(
		private readonly getOrganizationByIdQuery: GetOrganizationByIdQuery,
		private readonly listOrganizationsQuery: ListOrganizationsQuery,
		private readonly createOrganizationCommand: CreateOrganizationCommand,
		private readonly updateOrganizationCommand: UpdateOrganizationCommand,
		private readonly deleteOrganizationCommand: DeleteOrganizationCommand,
	) {}

	@Router('organizations')
	router() {
		return {
			list: publicProcedure.output(z.array(organizationSchema)).query(async () => {
				return this.listOrganizationsQuery.execute();
			}),

			getById: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(organizationSchema)
				.query(async ({ input }) => {
					return this.getOrganizationByIdQuery.execute(input.id);
				}),

			create: publicProcedure
				.input(createOrganizationSchema)
				.output(organizationSchema)
				.mutation(async ({ input }) => {
					return this.createOrganizationCommand.execute(input);
				}),

			update: publicProcedure
				.input(z.object({ id: z.string().uuid(), data: updateOrganizationSchema }))
				.output(organizationSchema)
				.mutation(async ({ input }) => {
					return this.updateOrganizationCommand.execute(input.id, input.data);
				}),

			delete: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(organizationSchema)
				.mutation(async ({ input }) => {
					return this.deleteOrganizationCommand.execute(input.id);
				}),
		};
	}
}
