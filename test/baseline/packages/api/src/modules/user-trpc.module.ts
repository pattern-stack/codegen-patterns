/**
 * User tRPC Module
 * Generated by entity codegen - do not edit directly
 *
 * Provides tRPC procedures for User CRUD operations.
 * Mounts on /api/trpc/users
 */

import { Module } from '@nestjs/common';
import { TrpcModule } from './trpc/trpc.module';
import { Router, publicProcedure } from './trpc/trpc.router';
import { z } from 'zod';
import {
	userSchema,
	createUserSchema,
	updateUserSchema,
} from '@repo/db/entities/user';
import { GetUserByIdQuery } from '../application/queries/user/get-by-id.query';
import { ListUsersQuery } from '../application/queries/user/list.query';
import { CreateUserCommand } from '../application/commands/user/create.command';
import { UpdateUserCommand } from '../application/commands/user/update.command';
import { DeleteUserCommand } from '../application/commands/user/delete.command';
import { UsersModule } from './users.module';

@Module({
	imports: [TrpcModule, UsersModule],
})
export class UserTrpcModule {
	constructor(
		private readonly getUserByIdQuery: GetUserByIdQuery,
		private readonly listUsersQuery: ListUsersQuery,
		private readonly createUserCommand: CreateUserCommand,
		private readonly updateUserCommand: UpdateUserCommand,
		private readonly deleteUserCommand: DeleteUserCommand,
	) {}

	@Router('users')
	router() {
		return {
			list: publicProcedure.output(z.array(userSchema)).query(async () => {
				return this.listUsersQuery.execute();
			}),

			getById: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(userSchema)
				.query(async ({ input }) => {
					return this.getUserByIdQuery.execute(input.id);
				}),

			create: publicProcedure
				.input(createUserSchema)
				.output(userSchema)
				.mutation(async ({ input }) => {
					return this.createUserCommand.execute(input);
				}),

			update: publicProcedure
				.input(z.object({ id: z.string().uuid(), data: updateUserSchema }))
				.output(userSchema)
				.mutation(async ({ input }) => {
					return this.updateUserCommand.execute(input.id, input.data);
				}),

			delete: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(userSchema)
				.mutation(async ({ input }) => {
					return this.deleteUserCommand.execute(input.id);
				}),
		};
	}
}
