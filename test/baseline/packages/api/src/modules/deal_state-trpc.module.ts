/**
 * DealState tRPC Module
 * Generated by entity codegen - do not edit directly
 *
 * Provides tRPC procedures for DealState CRUD operations.
 * Mounts on /api/trpc/deal_states
 */

import { Module } from '@nestjs/common';
import { TrpcModule } from './trpc/trpc.module';
import { Router, publicProcedure } from './trpc/trpc.router';
import { z } from 'zod';
import {
	dealStateSchema,
	createDealStateSchema,
	updateDealStateSchema,
} from '@repo/db/entities/deal_state';
import { GetDealStateByIdQuery } from '../application/queries/deal_state/get-by-id.query';
import { ListDealStatesQuery } from '../application/queries/deal_state/list.query';
import { CreateDealStateCommand } from '../application/commands/deal_state/create.command';
import { UpdateDealStateCommand } from '../application/commands/deal_state/update.command';
import { DeleteDealStateCommand } from '../application/commands/deal_state/delete.command';
import { DealStatesModule } from './deal_states.module';

@Module({
	imports: [TrpcModule, DealStatesModule],
})
export class DealStateTrpcModule {
	constructor(
		private readonly getDealStateByIdQuery: GetDealStateByIdQuery,
		private readonly listDealStatesQuery: ListDealStatesQuery,
		private readonly createDealStateCommand: CreateDealStateCommand,
		private readonly updateDealStateCommand: UpdateDealStateCommand,
		private readonly deleteDealStateCommand: DeleteDealStateCommand,
	) {}

	@Router('deal_states')
	router() {
		return {
			list: publicProcedure.output(z.array(dealStateSchema)).query(async () => {
				return this.listDealStatesQuery.execute();
			}),

			getById: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(dealStateSchema)
				.query(async ({ input }) => {
					return this.getDealStateByIdQuery.execute(input.id);
				}),

			create: publicProcedure
				.input(createDealStateSchema)
				.output(dealStateSchema)
				.mutation(async ({ input }) => {
					return this.createDealStateCommand.execute(input);
				}),

			update: publicProcedure
				.input(z.object({ id: z.string().uuid(), data: updateDealStateSchema }))
				.output(dealStateSchema)
				.mutation(async ({ input }) => {
					return this.updateDealStateCommand.execute(input.id, input.data);
				}),

			delete: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(dealStateSchema)
				.mutation(async ({ input }) => {
					return this.deleteDealStateCommand.execute(input.id);
				}),
		};
	}
}
