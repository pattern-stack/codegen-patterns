/**
 * Person tRPC Module
 * Generated by entity codegen - do not edit directly
 *
 * Provides tRPC procedures for Person CRUD operations.
 * Mounts on /api/trpc/persons
 */

import { Module } from '@nestjs/common';
import { TrpcModule } from './trpc/trpc.module';
import { Router, publicProcedure } from './trpc/trpc.router';
import { z } from 'zod';
import {
	personSchema,
	createPersonSchema,
	updatePersonSchema,
} from '@repo/db/entities/person';
import { GetPersonByIdQuery } from '../application/queries/person/get-by-id.query';
import { ListPersonsQuery } from '../application/queries/person/list.query';
import { CreatePersonCommand } from '../application/commands/person/create.command';
import { UpdatePersonCommand } from '../application/commands/person/update.command';
import { DeletePersonCommand } from '../application/commands/person/delete.command';
import { PersonsModule } from './persons.module';

@Module({
	imports: [TrpcModule, PersonsModule],
})
export class PersonTrpcModule {
	constructor(
		private readonly getPersonByIdQuery: GetPersonByIdQuery,
		private readonly listPersonsQuery: ListPersonsQuery,
		private readonly createPersonCommand: CreatePersonCommand,
		private readonly updatePersonCommand: UpdatePersonCommand,
		private readonly deletePersonCommand: DeletePersonCommand,
	) {}

	@Router('persons')
	router() {
		return {
			list: publicProcedure.output(z.array(personSchema)).query(async () => {
				return this.listPersonsQuery.execute();
			}),

			getById: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(personSchema)
				.query(async ({ input }) => {
					return this.getPersonByIdQuery.execute(input.id);
				}),

			create: publicProcedure
				.input(createPersonSchema)
				.output(personSchema)
				.mutation(async ({ input }) => {
					return this.createPersonCommand.execute(input);
				}),

			update: publicProcedure
				.input(z.object({ id: z.string().uuid(), data: updatePersonSchema }))
				.output(personSchema)
				.mutation(async ({ input }) => {
					return this.updatePersonCommand.execute(input.id, input.data);
				}),

			delete: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(personSchema)
				.mutation(async ({ input }) => {
					return this.deletePersonCommand.execute(input.id);
				}),
		};
	}
}
