---
to: "<%= exposeTrpc ? `${basePaths.backendSrc}/${paths.modules}/${name}-trpc.module.ts` : '' %>"
force: true
---
<% if (exposeTrpc) { -%>
/**
 * <%= className %> tRPC Module
 * Generated by entity codegen - do not edit directly
 *
 * Provides tRPC procedures for <%= className %> CRUD operations.
 * Mounts on /api/trpc/<%= plural %>
 */

import { Module } from '@nestjs/common';
import { TrpcModule } from './trpc/trpc.module';
import { Router, publicProcedure } from './trpc/trpc.router';
import { z } from 'zod';
import {
	<%= camelName %>Schema,
	create<%= className %>Schema,
	update<%= className %>Schema,
} from '@repo/db/entities/<%= name %>';
import { Get<%= className %>ByIdQuery } from '<%= imports.moduleToGetByIdQuery %>';
import { List<%= classNamePlural %>Query } from '<%= imports.moduleToListQuery %>';
import { Create<%= className %>Command } from '<%= imports.moduleToCreateCommand %>';
import { Update<%= className %>Command } from '<%= imports.moduleToUpdateCommand %>';
import { Delete<%= className %>Command } from '<%= imports.moduleToDeleteCommand %>';
import { <%= classNamePlural %>Module } from './<%= plural %>.module';

@Module({
	imports: [TrpcModule, <%= classNamePlural %>Module],
})
export class <%= className %>TrpcModule {
	constructor(
		private readonly get<%= className %>ByIdQuery: Get<%= className %>ByIdQuery,
		private readonly list<%= classNamePlural %>Query: List<%= classNamePlural %>Query,
		private readonly create<%= className %>Command: Create<%= className %>Command,
		private readonly update<%= className %>Command: Update<%= className %>Command,
		private readonly delete<%= className %>Command: Delete<%= className %>Command,
	) {}

	@Router('<%= plural %>')
	router() {
		return {
			list: publicProcedure.output(z.array(<%= camelName %>Schema)).query(async () => {
				return this.list<%= classNamePlural %>Query.execute();
			}),

			getById: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(<%= camelName %>Schema)
				.query(async ({ input }) => {
					return this.get<%= className %>ByIdQuery.execute(input.id);
				}),

			create: publicProcedure
				.input(create<%= className %>Schema)
				.output(<%= camelName %>Schema)
				.mutation(async ({ input }) => {
					return this.create<%= className %>Command.execute(input);
				}),

			update: publicProcedure
				.input(z.object({ id: z.string().uuid(), data: update<%= className %>Schema }))
				.output(<%= camelName %>Schema)
				.mutation(async ({ input }) => {
					return this.update<%= className %>Command.execute(input.id, input.data);
				}),

			delete: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(<%= camelName %>Schema)
				.mutation(async ({ input }) => {
					return this.delete<%= className %>Command.execute(input.id);
				}),
		};
	}
}
<% } -%>
