---
to: "<%= exposeTrpc ? `${basePaths.backendSrc}/${paths.modules}/${name}-trpc.module.ts` : '' %>"
force: true
---
<% if (exposeTrpc) { -%>
/**
 * <%= className %> tRPC Module
 * Generated by entity codegen - do not edit directly
 *
 * Provides tRPC procedures for <%= className %> CRUD operations.
 * Mounts on /api/trpc/<%= plural %>
 */

import { Module } from '@nestjs/common';
import { TrpcModule } from './trpc/trpc.module';
import { Router, publicProcedure } from './trpc/trpc.router';
import { z } from 'zod';
import {
	<%= camelName %>Schema,
	create<%= className %>Schema,
	update<%= className %>Schema,
} from '<%= locations.dbEntities.import %>/<%= name %>';
import { <%= getByIdQueryClass %> } from '<%= imports.moduleToGetByIdQuery %>';
import { <%= listQueryClass %> } from '<%= imports.moduleToListQuery %>';
import { <%= createCommandClass %> } from '<%= imports.moduleToCreateCommand %>';
import { <%= updateCommandClass %> } from '<%= imports.moduleToUpdateCommand %>';
import { <%= deleteCommandClass %> } from '<%= imports.moduleToDeleteCommand %>';
import { <%= classNamePlural %>Module } from './<%= plural %>.module';

@Module({
	imports: [TrpcModule, <%= classNamePlural %>Module],
})
export class <%= className %>TrpcModule {
	constructor(
		private readonly get<%= className %>ByIdQuery: <%= getByIdQueryClass %>,
		private readonly list<%= classNamePlural %>Query: <%= listQueryClass %>,
		private readonly create<%= className %>Command: <%= createCommandClass %>,
		private readonly update<%= className %>Command: <%= updateCommandClass %>,
		private readonly delete<%= className %>Command: <%= deleteCommandClass %>,
	) {}

	@Router('<%= plural %>')
	router() {
		return {
			list: publicProcedure.output(z.array(<%= camelName %>Schema)).query(async () => {
				return this.list<%= classNamePlural %>Query.execute();
			}),

			getById: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(<%= camelName %>Schema)
				.query(async ({ input }) => {
					return this.get<%= className %>ByIdQuery.execute(input.id);
				}),

			create: publicProcedure
				.input(create<%= className %>Schema)
				.output(<%= camelName %>Schema)
				.mutation(async ({ input }) => {
					return this.create<%= className %>Command.execute(input);
				}),

			update: publicProcedure
				.input(z.object({ id: z.string().uuid(), data: update<%= className %>Schema }))
				.output(<%= camelName %>Schema)
				.mutation(async ({ input }) => {
					return this.update<%= className %>Command.execute(input.id, input.data);
				}),

			delete: publicProcedure
				.input(z.object({ id: z.string().uuid() }))
				.output(<%= camelName %>Schema)
				.mutation(async ({ input }) => {
					return this.delete<%= className %>Command.execute(input.id);
				}),
		};
	}
}
<% } -%>
