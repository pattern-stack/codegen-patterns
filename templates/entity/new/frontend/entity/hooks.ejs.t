---
to: "<%= generate.structure === 'entity-first' ? `${locations.frontendGenerated.path}/${name}/hooks.ts` : generate.structure === 'concern-first' ? `${locations.frontendGenerated.path}/hooks/${name}.ts` : '' %>"
skip_if: <%= generate.structure === 'monolithic' %>
force: true
---
/**
 * <%= className %> Hooks
 * Generated by entity codegen - do not edit directly
 *
 * React hooks returning resolved entities with relations
 */

<% if (generate.hookStyle === 'useLiveQuery') { -%>
import { useLiveQuery, eq } from '@tanstack/react-db';
<% } -%>
<% if (generate.structure === 'entity-first') { -%>
import { <%= camelName %>Collection, resolveRelations } from './collection';
import type { <%= className %>Resolved } from './types';
<% } else if (generate.structure === 'concern-first') { -%>
import { <%= camelName %>Collection, resolveRelations } from '../collections/<%= name %>';
import type { <%= className %>Resolved } from '../types/<%= name %>';
<% } -%>
<% if (generate.hookStyle === 'useLiveQuery') { -%>

/** Get all <%= plural %> with relations resolved */
export function use<%= classNamePlural %>() {
	const result = useLiveQuery((q) => q.from({ <%= camelName %>Collection }), []);
	return {
		data: result.data?.map(resolveRelations) ?? [],
		isLoading: result.isLoading,
	};
}

/** Get single <%= camelName %> by ID with relations resolved */
export function use<%= className %>(id: string | undefined) {
	const result = useLiveQuery(
		(q) => {
			if (!id) return undefined;
			return q
				.from({ <%= camelName %>Collection })
				.where(({ <%= camelName %>Collection }) => eq(<%= camelName %>Collection.id, id));
		},
		[id],
	);
	const entity = result.data?.[0];
	return {
		data: entity ? resolveRelations(entity) : undefined,
		isLoading: result.isLoading,
	};
}
<% } else { -%>

/** Get all <%= plural %> with relations resolved */
export function use<%= classNamePlural %>(): <%= className %>Resolved[] {
	const raw = <%= camelName %>Collection.useMany();
	return raw.map(resolveRelations);
}

/** Get single <%= camelName %> by ID with relations resolved */
export function use<%= className %>(id: string | undefined): <%= className %>Resolved | undefined {
	const raw = <%= camelName %>Collection.useOne(id);
	return raw ? resolveRelations(raw) : undefined;
}
<% } -%>
