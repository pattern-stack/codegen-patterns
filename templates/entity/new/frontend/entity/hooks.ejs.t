---
to: "<%= generate.structure === 'entity-first' ? `${locations.frontendGenerated.path}/${generate.fileNaming === 'plural' ? plural : name}/hooks.ts` : generate.structure === 'concern-first' ? `${locations.frontendGenerated.path}/hooks/${generate.fileNaming === 'plural' ? plural : name}.ts` : '' %>"
skip_if: <%= generate.structure === 'monolithic' %>
force: true
---
/**
 * <%= className %> Hooks
 * Generated by entity codegen - do not edit directly
 *
 * React hooks returning resolved entities with relations
 */

<%
// Collection variable name depends on collectionNaming config
const collectionVar = generate.collectionNaming === 'plural' ? collectionVarNamePlural : collectionVarName;
// File name for imports depends on fileNaming config
const fileName = generate.fileNaming === 'plural' ? plural : name;
// Hook return key depends on hookReturnStyle config
const returnKey = generate.hookReturnStyle === 'named' ? pluralCamelName : 'data';
const returnKeySingular = generate.hookReturnStyle === 'named' ? camelName : 'data';
-%>
<% if (generate.hookStyle === 'useLiveQuery') { -%>
import { useLiveQuery, eq } from '@tanstack/react-db';
<% } -%>
<% if (generate.structure === 'entity-first') { -%>
import { <%= collectionVar %>, resolveRelations } from './collection';
import type { <%= className %>Resolved } from './types';
<% } else if (generate.structure === 'concern-first') { -%>
import { <%= collectionVar %>, resolveRelations } from '../collections/<%= fileName %>';
import type { <%= className %>Resolved } from '../types/<%= fileName %>';
<% } -%>
<% if (generate.hookStyle === 'useLiveQuery') { -%>

/** Get all <%= plural %> with relations resolved */
export function use<%= classNamePlural %>() {
	const result = useLiveQuery((q) => q.from({ <%= collectionVar %> }), []);
	return {
		<%= returnKey %>: result.data?.map(resolveRelations) ?? [],
		isLoading: result.isLoading,
	};
}

/** Get single <%= camelName %> by ID with relations resolved */
export function use<%= className %>(id: string | undefined) {
	const result = useLiveQuery(
		(q) => {
			if (!id) return undefined;
			return q
				.from({ <%= collectionVar %> })
				.where(({ <%= collectionVar %> }) => eq(<%= collectionVar %>.id, id));
		},
		[id],
	);
	const entity = result.data?.[0];
	return {
		<%= returnKeySingular %>: entity ? resolveRelations(entity) : undefined,
		isLoading: result.isLoading,
	};
}
<% } else { -%>

/** Get all <%= plural %> with relations resolved */
export function use<%= classNamePlural %>(): <%= className %>Resolved[] {
	const raw = <%= collectionVar %>.useMany();
	return raw.map(resolveRelations);
}

/** Get single <%= camelName %> by ID with relations resolved */
export function use<%= className %>(id: string | undefined): <%= className %>Resolved | undefined {
	const raw = <%= collectionVar %>.useOne(id);
	return raw ? resolveRelations(raw) : undefined;
}
<% } -%>
